<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#10B981">
    <title data-fa="ثبت‌نام" data-en="Register">ثبت‌نام</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-6">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-semibold text-green-800" data-fa="ثبت‌نام" data-en="Register">ثبت‌نام</h1>
            <button id="langToggle" class="bg-green-600 text-white px-3 py-1 rounded">EN</button>
        </div>
        <form id="registerForm" class="bg-white rounded-lg shadow-md p-6 max-w-md mx-auto">
            <div class="mb-4">
                <label for="first_name" class="block text-gray-700" data-fa="نام:" data-en="First Name:">نام:</label>
                <input type="text" id="first_name" class="w-full p-2 border rounded" required>
            </div>
            <div class="mb-4">
                <label for="last_name" class="block text-gray-700" data-fa="نام خانوادگی:" data-en="Last Name:">نام خانوادگی:</label>
                <input type="text" id="last_name" class="w-full p-2 border rounded" required>
            </div>
            <div class="mb-4">
                <label for="email" class="block text-gray-700" data-fa="ایمیل:" data-en="Email:">ایمیل:</label>
                <input type="email" id="email" class="w-full p-2 border rounded" required>
            </div>
            <div class="mb-4">
                <label for="country_code" class="block text-gray-700" data-fa="کد کشور:" data-en="Country Code:">کد کشور:</label>
                <select id="country_code" class="w-full p-2 border rounded" required></select>
            </div>
            <div class="mb-4">
                <label for="mobile" class="block text-gray-700" data-fa="شماره همراه (بدون کد کشور):" data-en="Mobile (without country code):">شماره همراه (بدون کد کشور):</label>
                <input type="text" id="mobile" class="w-full p-2 border rounded" required>
            </div>
            <div class="mb-4">
                <label for="role" class="block text-gray-700" data-fa="نقش:" data-en="Role:">نقش:</label>
                <select id="role" class="w-full p-2 border rounded" required>
                    <option value="" disabled selected data-fa="انتخاب کنید" data-en="Select">انتخاب کنید</option>
                    <option value="tourist" data-fa="توریست" data-en="Tourist">توریست</option>
                    <option value="representative" data-fa="نماینده" data-en="Representative">نماینده</option>
                    <option value="doctor" data-fa="پزشک" data-en="Doctor">پزشک</option>
                    <option value="subadmin" data-fa="زیرمدیر" data-en="Sub-admin">زیرمدیر</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="password" class="block text-gray-700" data-fa="پسورد:" data-en="Password:">پسورد:</label>
                <input type="password" id="password" class="w-full p-2 border rounded" required>
            </div>
            <div class="mb-4">
                <label for="age" class="block text-gray-700" data-fa="سن:" data-en="Age:">سن:</label>
                <input type="number" id="age" class="w-full p-2 border rounded" required>
            </div>
            <div class="mb-4">
                <label for="gender" class="block text-gray-700" data-fa="جنسیت:" data-en="Gender:">جنسیت:</label>
                <select id="gender" class="w-full p-2 border rounded" required>
                    <option value="" disabled selected data-fa="انتخاب کنید" data-en="Select">انتخاب کنید</option>
                    <option value="male" data-fa="مرد" data-en="Male">مرد</option>
                    <option value="female" data-fa="زن" data-en="Female">زن</option>
                    <option value="other" data-fa="سایر" data-en="Other">سایر</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="address" class="block text-gray-700" data-fa="آدرس:" data-en="Address:">آدرس:</label>
                <textarea id="address" class="w-full p-2 border rounded" required></textarea>
            </div>
            <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" data-fa="ثبت‌نام" data-en="Register">ثبت‌نام</button>
            <p class="mt-4 text-gray-600">
                <span data-fa="حساب کاربری دارید؟" data-en="Already have an account?">حساب کاربری دارید؟</span>
                <a href="/login.html" class="text-green-600 hover:underline" data-fa="ورود کنید" data-en="Login here">ورود کنید</a>
            </p>
        </form>
    </div>
    <script>
        const countries = [
            { name_fa: "ایران", name_en: "Iran", dial_code: "+98", code: "IR" },
            { name_fa: "ایالات متحده", name_en: "United States", dial_code: "+1", code: "US" },
            { name_fa: "انگلستان", name_en: "United Kingdom", dial_code: "+44", code: "GB" },
            { name_fa: "آلمان", name_en: "Germany", dial_code: "+49", code: "DE" },
            { name_fa: "فرانسه", name_en: "France", dial_code: "+33", code: "FR" },
            { name_fa: "چین", name_en: "China", dial_code: "+86", code: "CN" },
            { name_fa: "ژاپن", name_en: "Japan", dial_code: "+81", code: "JP" },
            { name_fa: "هند", name_en: "India", dial_code: "+91", code: "IN" },
            { name_fa: "روسیه", name_en: "Russia", dial_code: "+7", code: "RU" },
            { name_fa: "برزیل", name_en: "Brazil", dial_code: "+55", code: "BR" },
            { name_fa: "کانادا", name_en: "Canada", dial_code: "+1", code: "CA" },
            { name_fa: "استرالیا", name_en: "Australia", dial_code: "+61", code: "AU" },
            { name_fa: "ترکیه", name_en: "Turkey", dial_code: "+90", code: "TR" },
            { name_fa: "عربستان", name_en: "Saudi Arabia", dial_code: "+966", code: "SA" },
            { name_fa: "امارات", name_en: "United Arab Emirates", dial_code: "+971", code: "AE" },
            { name_fa: "عراق", name_en: "Iraq", dial_code: "+964", code: "IQ" },
            { name_fa: "قطر", name_en: "Qatar", dial_code: "+974", code: "QA" },
            { name_fa: "کویت", name_en: "Kuwait", dial_code: "+965", code: "KW" },
            { name_fa: "عمان", name_en: "Oman", dial_code: "+968", code: "OM" },
            { name_fa: "مصر", name_en: "Egypt", dial_code: "+20", code: "EG" }
        ];

        const countrySelect = document.getElementById('country_code');
        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country.dial_code;
            option.setAttribute('data-fa', `${country.name_fa} (${country.dial_code})`);
            option.setAttribute('data-en', `${country.name_en} (${country.dial_code})`);
            option.textContent = `${country.name_fa} (${country.dial_code})`;
            countrySelect.appendChild(option);
        });

        let lang = localStorage.getItem('lang') || 'fa';
        const toggleBtn = document.getElementById('langToggle');

        function updateLanguage() {
            document.querySelectorAll('[data-fa]').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
            toggleBtn.textContent = lang === 'fa' ? 'EN' : 'FA';
        }

        toggleBtn.addEventListener('click', () => {
            lang = lang === 'fa' ? 'en' : 'fa';
            localStorage.setItem('lang', lang);
            updateLanguage();
        });

        updateLanguage();

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const first_name = document.getElementById('first_name').value;
            const last_name = document.getElementById('last_name').value;
            const email = document.getElementById('email').value;
            const country_code = document.getElementById('country_code').value;
            const mobile = country_code + document.getElementById('mobile').value;
            const role = document.getElementById('role').value;
            const password = document.getElementById('password').value;
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const address = document.getElementById('address').value;

            fetch('/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ first_name, last_name, email, mobile, role, password, age, gender, address })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem('user', JSON.stringify({ id: data.userId, mobile, email, role, age, gender, address }));
                    window.location.href = '/verify.html';
                } else {
                    alert((lang === 'fa' ? 'خطا در ثبت‌نام: ' : 'Registration error: ') + data.error);
                }
            })
            .catch(err => {
                console.error('Error during registration:', err);
                alert(lang === 'fa' ? 'خطا در ارتباط با سرور.' : 'Server connection error.');
            });
        });
    </script>
</body>
</html>
